!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.CastMyData=a.CastMyData||{})}(this,function(a){"use strict";var b=function(){function b(a){this.head=new c,this.tail=new c(this.head),this.head.next=this.tail,this.linkConstructor=a,this.reg={}}function c(a,b,c){this.prev=a,this.next=b,this.fn=c||d}function d(){}function e(){this._events={}}var a=0;return b.prototype={insert:function(a){var b=new c(this.tail.prev,this.tail,a);return b.next.prev=b.prev.next=b,b},remove:function(a){a.prev.next=a.next,a.next.prev=a.prev}},c.prototype.run=function(a){this.fn(a),this.next&&this.next.run(a)},e.prototype={on:function(c,d){var e=this;c.split(/\W+/g).forEach(function(c){var f=e._events[c]||(e._events[c]=new b),g=d._eev||(d._eev=++a);f.reg[g]||(f.reg[g]=f.insert(d))})},off:function(a,b){var c=this;a.split(/\W+/g).forEach(function(a){var d=c._events[a],e=d.reg[b._eev];d.reg[b._eev]=void 0,d&&e&&d.remove(e)})},emit:function(a,b){var c=this._events[a];c&&c.head.run(b)}},e}(),c=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c)},d=function(a,b){var b=b||{},d=this;c(b,function(a,b){d[b]=a}),this._events={},this._endpoint=a};d.prototype=Object.create(b.prototype),d.prototype["delete"]=function(){this._endpoint["delete"](this.id)},d.prototype.put=function(a){var a=a||{},b=this;c(a,function(a,c){b[c]=a}),this._endpoint.put(this.id,a)};var e=function(a,b){var e=this._socket=io(a,{multiplex:!1}),f=[],g=this;this._events={},e.path=b,e.on("records",function(a){f.splice(0,f.length);a.forEach(function(a){a=new d(g,a),a.emit("post",a),f.push(a)});g.emit("records",f)}),e.on("post",function(a){var b=new d(g,a.payload);f.push(b),g.emit("post",b)}),e.on("put",function(a){var b=f.filter(function(b){return b.id==a.id}).pop();b&&(c(a.payload,function(a,c){b[c]=a}),b.emit("put",a.payload),g.emit("put",b,a.payload))}),e.on("delete",function(a){var b=f.filter(function(b){return b.id==a.id}).pop(),c=f.indexOf(b);b&&(f.splice(c,1),b.emit("delete"),g.emit("delete",b))}),e.on("connect",function(){e.emit("join",b)})};e.prototype=Object.create(b.prototype),e.prototype.post=function(a){return this._socket.emit("post",{path:this._socket.path,payload:a}),this},e.prototype.put=function(a,b){return this._socket.emit("put",{path:this._socket.path,payload:b,id:a}),this},e.prototype["delete"]=function(a){return this._socket.emit("delete",{path:this._socket.path,id:a}),this},a.Model=d,a.Endpoint=e});